@model IEnumerable<PhongNguyenPuppy_MVC.ViewModels.HangHoaVM>
@using PhongNguyenPuppy_MVC.ViewModels

@{
    ViewData["Title"] = "Search";
    Layout = "_DanhSachHangHoa";
    var pageNumber = (int)(ViewBag.PageNumber ?? 1);
    var totalPages = (int)(ViewBag.TotalPages ?? 1);
    var query = ViewBag.Query;
    var pageContent = ViewBag.PageContent as PageContentVM;
}

@* Single Page Header start *@
@section BreadCum {
    <div class="container-fluid page-header py-5">
        <h1 class="text-center text-white display-6">
            @(ViewBag.H1Heading ?? "Kết quả tìm kiếm")
        </h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
                <li class="breadcrumb-item"><a asp-controller="HangHoa" asp-action="Index">Sản phẩm</a></li>
                <li class="breadcrumb-item active text-white" aria-current="page">Tìm kiếm: "@query"</li>
            </ol>
        </nav>
    </div>
}
@* Single Page Header End *@

@* ===== PHẦN NỘI DUNG SEO - INTRO ===== *@
@if (pageContent != null && !string.IsNullOrEmpty(pageContent.IntroText))
{
    <div class="col-12 mb-4">
        <div class="alert alert-light border">
            <h2 class="h5 mb-3"><i class="fa fa-info-circle text-primary"></i> @pageContent.Title</h2>
            <p class="mb-0 lead">@pageContent.IntroText</p>
        </div>
    </div>
}

@* ===== DANH SÁCH SẢN PHẨM ===== *@
<div class="col-12">
    <h2 class="visually-hidden">Danh sách sản phẩm tìm được</h2>
</div>

@await Html.PartialAsync("ProductItem", Model)

@* ===== PHẦN NỘI DUNG SEO CHI TIẾT ===== *@
@foreach (var sec in pageContent.Sections)
{
    <div class="col-md-6">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <h3 class="h5 card-title mb-3">
                    @if (!string.IsNullOrEmpty(sec.IconClass))
                    {
                        <i class="@sec.IconClass text-primary me-2"></i>
                    }
                    @(sec.Heading)
                </h3>
                <p class="card-text text-muted">@(sec.Content)</p>
            </div>
        </div>
    </div>
}


@* ===== PHẦN NỘI DUNG SEO - BOTTOM ===== *@
@if (pageContent != null && !string.IsNullOrEmpty(pageContent.BottomText))
{
    <div class="col-12 my-4">
        <div class="alert alert-success border-0">
            <p class="mb-0"><strong><i class="fa fa-heart text-danger"></i> Cam kết của chúng tôi:</strong> @pageContent.BottomText</p>
        </div>
    </div>
}

@* ===== PHÂN TRANG ===== *@
@if (totalPages > 1)
{
    <div class="col-12">
        <nav aria-label="Phân trang kết quả tìm kiếm">
            <div class="pagination d-flex justify-content-center mt-5">
                @if (pageNumber > 1)
                {
                    <a class="rounded" 
                       href="@Url.Action("Search", new { query, page = pageNumber - 1 })" 
                       rel="prev" 
                       aria-label="Trang trước">&laquo;</a>
                }
                else
                {
                    <span class="rounded disabled" aria-hidden="true">&laquo;</span>
                }

                @for (int i = 1; i <= totalPages; i++)
                {
                    if (i == pageNumber)
                    {
                        <a class="rounded active" 
                           href="@Url.Action("Search", new { query, page = i })" 
                           aria-current="page" 
                           aria-label="Trang @i, trang hiện tại">@i</a>
                    }
                    else
                    {
                        <a class="rounded" 
                           href="@Url.Action("Search", new { query, page = i })" 
                           aria-label="Đi đến trang @i">@i</a>
                    }
                }

                @if (pageNumber < totalPages)
                {
                    <a class="rounded" 
                       href="@Url.Action("Search", new { query, page = pageNumber + 1 })" 
                       rel="next" 
                       aria-label="Trang tiếp theo">&raquo;</a>
                }
                else
                {
                    <span class="rounded disabled" aria-hidden="true">&raquo;</span>
                }
            </div>
        </nav>
    </div>
}

@* ===== FAQ SECTION (Thêm từ khóa liên quan) ===== *@
<div class="col-12 mt-5">
    <div class="seo-faq-section">
        <h2 class="h4 mb-4 text-center">Câu Hỏi Thường Gặp</h2>
        <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
                <h3 class="accordion-header" id="faq1">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                        PhongNguyen Puppy có giao hàng tận nơi không?
                    </button>
                </h3>
                <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Có, chúng tôi giao hàng toàn quốc. Miễn phí ship với đơn hàng trên 500.000 VNĐ tại TP.HCM và vùng lân cận. Thời gian giao hàng từ 1-3 ngày tùy khu vực.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h3 class="accordion-header" id="faq2">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                        Làm sao để chọn thức ăn phù hợp cho chó của tôi?
                    </button>
                </h3>
                <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Bạn cần xem xét giống chó, độ tuổi, cân nặng và tình trạng sức khỏe. Liên hệ hotline của chúng tôi để được tư vấn miễn phí từ chuyên gia dinh dưỡng thú cưng.
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h3 class="accordion-header" id="faq3">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                        Sản phẩm có chính hãng không?
                    </button>
                </h3>
                <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        100% sản phẩm tại PhongNguyen Puppy đều là hàng chính hãng, có tem nhãn rõ ràng, nguồn gốc xuất xứ minh bạch. Chúng tôi cam kết hoàn tiền nếu phát hiện hàng giả.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>